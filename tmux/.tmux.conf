# =============================================================================
# Inspired by:
# - http://peterforgacs.github.io/2017/04/25/Tmux/
# - https://www.hamvocke.com/blog/a-guide-to-customizing-your-tmux-conf/
# - https://www.bugsnag.com/blog/tmux-and-vim
# - https://github.com/gpakosz/.tmux
# - https://github.com/samoshkin/tmux-config
# =============================================================================
# Commands
# set = set-option
# set -p => set-option for PANE
# set -w => set-option for WINDOW
# set -g => set-option for global / all sessions
# set -s => set-option for server
# set -a => set-option with string or STYLE
#
# <prefix> table => combinations of keys AFTER the <prefix>
# bind C-l send-keys C-l \; run clear-history
#
# root table => without the prefix
# bind -n (or -T) M-1
#
# bind -N => attaches a note to the key
#
#
# bind = bind-key
# bind-key
# send-keys
# setw
#
# =============================================================================
# Plugins
# - Plugin Manager: https://github.com/tmux-plugins/tpm
#
#  git clone https://github.com/tmux-plugins/tpm ~/.tmux/plugins/tpm
#
# - restore sessions after system restart:
#   https://github.com/tmux-plugins/tmux-resurrect
#
# - automatically save sessions
#   https://github.com/tmux-plugins/tmux-continuum
#
#   https://github.com/tmux-plugins/vim-tmux
#
#   https://github.com/tmux-plugins/tmux-cpu
#
#   https://github.com/tmux-plugins/tmux-sidebar
#
#   https://github.com/tmux-plugins/tmux-online-status
#
# =============================================================================

set -g default-terminal "screen-256color"
set -g default-shell /bin/zsh
setw -g xterm-keys on

set -s escape-time 10
set -sg repeat-time 600
set -s focus-events on

#set -g prefix2 C-a
#bind C-a send-prefix -2
#set -q -g status-utf8 on
setw -q -g utf8 on
set -g history-limit 5000

# =============================
# display
# =============================

# start windows numbering at 1
set -g base-index 1
# make pane numbering consistent with windows
setw -g pane-base-index 1
# rename window to reflect current program
#setw -g automatic-rename on
# don't rename windows automatically
set-option -g allow-rename off
# renumber windows when a window is closed
set -g renumber-windows on
# set terminal title
set -g set-titles on
# slightly longer pane indicators display time
set -g display-panes-time 800
# slightly longer status messages display time
set -g display-time 1200
# redraw status line every 10 seconds
set -g status-interval 10
# clear both screen and history
bind -n C-l send-keys C-l \; run 'sleep 0.1' \; clear-history

# activity
set -g monitor-activity on
set -g visual-activity off


#set -g status-keys vi
# history limit
set -g history-limit 10000

# Enable mouse mode (tmux 2.1 and above)
#set -g mouse on

# split panes using | and -
#bind-key -N "horizontal" -T root S-F2 split-window -h
bind-key -T root S-F2 split-window -h
bind-key -T root C-F2 split-window -v
unbind '"'
unbind %

# toggle mouse ON and OFF
bind-key -T root M-F12 set-option -g mouse \;\
    display "Mouse #{?mouse,ON,OFF}"

# switch panes using Alt-arrow without prefix (like byobu)
bind -n M-Left select-pane -L
bind -n M-Right select-pane -R
bind -n M-Up select-pane -U
bind -n M-Down select-pane -D

bind-key -T root S-M-Left select-window -t:-1
bind-key -T root S-M-Right select-window -t:+1

 unbind r
 bind r \
     source-file ~/.tmux.conf \;\
         display 'Reloaded tmux config.'

# vim-like navigation
# as seen in: https://www.bugsnag.com/blog/tmux-and-vim
is_vim="ps -o state= -o comm= -t '#{pane_tty}' \
    | grep -iqE '^[^TXZ ]+ +(\\S+\\/)?g?(view|n?vim?x?)(diff)?$'"

bind-key -n C-h  if-shell  "$is_vim"  "send-keys C-h"  "select-pane -L"
bind-key -n C-j  if-shell  "$is_vim"  "send-keys C-j"   "select-pane -D"
bind-key -n C-k  if-shell  "$is_vim"  "send-keys C-k"  "select-pane -U"
bind-key -n C-l  if-shell  "$is_vim"  "send-keys C-l"   "select-pane -R"
bind-key -n C-\  if-shell  "$is_vim"  "send-keys C-\\"  "select-pane -l"

# here are some nice ideas also:
# https://github.com/gpakosz/.tmux/blob/master/.tmux.conf

if '[ -f ~/.tmux.conf.local ]' 'source ~/.tmux.conf.local'
if '[ -f ~/.tmux.conf.design ]' 'source ~/.tmux.conf.design'

# Session is considered to be remote when we ssh into host
if-shell 'test -n "$SSH_CLIENT"' \
    'source-file ~/.tmux/tmux.remote.conf'

# see: toggle on/off all keybindings · Issue #237 · tmux/tmux - 
# https://github.com/tmux/tmux/issues/237
# Also, change some visual styles when window keys are off
bind-key -T root F12  \
    set prefix None \;\
    set key-table off \;\
    set status-style "fg=$color_status_text" \;\
    set status-style "bg=$color_window_off_status_bg" \;\
    #set window-status-current-format "#[fg=$color_window_off_status_bg,bg=$color_window_off_status_current_bg]$separator_powerline_right#[default] #I:#W# #[fg=$color_window_off_status_current_bg,bg=$color_window_off_status_bg]$separator_powerline_right#[default]" \;\
    set window-status-current-style "fg=$color_dark bold" \;\
    set window-status-current-style "bg=$color_window_off_status_current_bg" \;\
    if -F '#{pane_in_mode}' 'send-keys -X cancel' \;\
    refresh-client -S \;\

bind-key -T off F12 \
  set -u prefix \;\
  set -u key-table \;\
  set -u status-style \;\
  set -u window-status-current-style \;\
  set -u window-status-current-format \;\
  refresh-client -S

# Attach to a default session with HOSTNAME if already exists 
# otherwise create a new one
#new-session -A -s $HOST

# List of plugins
#set -g @plugin 'tmux-plugins/tpm'
#set -g @plugin 'tmux-plugins/tmux-sensible'
set -g @plugin 'tmux-plugins/tmux-resurrect'




# Initialize TMUX plugin manager (keep this line at the very bottom of tmux.conf)
#run -b '~/.tmux/plugins/tpm/tpm'
run -b '~/config/tmux/plugins/tpm/tpm'
